\section{Observation command and subcommand syntax\label{sec:observation-syntax}}

\subsection{Observation types}

The observation types available are,

\begin{description}
  \item Observations of proportions of individuals by age class
  \item Observations of proportions of individuals between categories within each age class
  \item Relative and absolute abundance observations
  \item Relative and absolute biomass observations
\end{description}

Each type of observation requires a set of subcommands and arguments specific to that process.

\defComLab{observation}{Define an observation}

\defSub{type} {Define the type of observation}
\defType{String}
\defDefault{No default}
\defValue{A valid type of observation}

\subsubsection[Proportions at age]{\commandlabsubarg{observation}{type}{proportions\_at\_age}}

\defSub{year} {Define the year that the observation applies to}
\defType{Integer}
\defDefault{No default}
\defValue{A positive integer between \commandsub{model}{initial\_year} and \commandsub{model}{current\_year}}

\defSub{time\_step} {Define the time-step that the observation applies to}
\defType{Integer}
\defDefault{No default}
\defValue{A valid time-step}

\defSub{proportion\_time\_step} {Define the interpolated proportion of the time-step passes that the observation applies to}
\defType{Constant}
\defDefault{1.0}
\defValue{A real number between 0 and 1, inclusive}

\defSub{categories} {Define the categories}
\defType{String vector}
\defDefault{No default}
\defValue{Valid categories from \commandsub{model}{categories}}

\defSub{selectivities} {Define the selectivities applied to each category}
\defType{String vector}
\defDefault{No default}
\defValue{Valid selectivity labels defined by \command{selectivity}}

\defSub{min\_age} {Define the minimum age for the observation}
\defType{Integer}
\defDefault{No default}
\defValue{A valid age in the range \commandsub{model}{min\_age} and \commandsub{model}{max\_age}}

\defSub{max\_age} {Define the maximum age for the observation}
\defType{Integer}
\defDefault{No default}
\defValue{A valid age in the range \commandsub{model}{min\_age} and \commandsub{model}{max\_age}}

\defSub{age\_plus\_group} {Define is the the maximum age for the observation is a plus group}
\defType{Switch}
\defDefault{True}
\defValue{Either true or false}

\defSub{ageing\_error} {Define the label of the ageing-error matrix to be applied (if any)}
\defType{String}
\defDefault{No default}
\defValue{A valid ageing error label}

\defSub{layer} {Name of the categorical layer used to group the spatial cells for the observation}
\defType{String}
\defDefault{No default}
\defValue{A valid layer as defined by \command{layer}. Must be a layer of \texttt{type=categorical}}

\defSub{obs [label]}{Define the following data as observations for the categorical layer with value \texttt{[label]}}
\defType{Constant vector}
\defDefault{No default}
\defValue{The label is valid value from the associated observation layer. It is followed by a vector of values giving the proportions at age. This subcommand is repeated for each unique value of label}

\defSub{tolerance}{Define the tolerance on the sum-to-one error check in \SPM}
\defType{Constant}
\defDefault{0.001}
\defValue{The tolerance on the sum to one error check. If $abs(1-\sum O_i) > \text{\argument{tolerance}}$ then \SPM\ will report an error}

\defSub{error\_value [label]}{Define the following data as error values (e.g., $N$ for multinomial likelihoods, c.v. for lognormal likelihoods, etc.) for the categorical layer with value \texttt{[label]}}
\defType{Constant}
\defDefault{No default}
\defValue{A valid value from the associated observation layer. This subcommand is repeated for each unique value of label}

\defSub{likelihood}{Define the likelihood for the observation}
\defType{String}
\defDefault{No default}
\defValue{A valid likelihood}

\defSub{delta}{Define the delta robustifying constant for the likelihood}
\defType{Constant}
\defDefault{1e-11}
\defValue{A non-negative real number}

\defSub{process\_error}{Define the process error term}
\defType{Constant}
\defDefault{No process error}
\defValue{A non-negative real number}

\defSub{simulation\_likelihood}{Define the likelihood when doing simulations, if the observations is a pseudo-observation}
\defType{String}
\defDefault{No default}
\defValue{A valid likelihood, except not \texttt{none}. Note that this command is ignored if the observation is not a pseudo-observation}

\subsubsection[Proportions by category]{\commandlabsubarg{observation}{type}{proportions\_by\_category}}

\defSub{year} {Define the year that the observation applies to}
\defType{Integer}
\defDefault{No default}
\defValue{A positive integer between \commandsub{model}{initial\_year} and \commandsub{model}{current\_year}}

\defSub{time\_step} {Define the time-step that the observation applies to}
\defType{Integer}
\defDefault{No default}
\defValue{A valid time-step}

\defSub{proportion\_time\_step} {Define the interpolated proportion of the time-step passes that the observation applies to}
\defType{Constant}
\defDefault{1.0}
\defValue{A real number between 0 and 1, inclusive}

\defSub{categories} {Define the categories}
\defType{String vector}
\defDefault{No default}
\defValue{Valid categories from \commandsub{model}{categories}}

\defSub{categories2} {Define the categories}
\defType{String vector}
\defDefault{No default}
\defValue{Valid categories from \commandsub{model}{categories}}

\defSub{selectivities} {Define the selectivities applied to each category}
\defType{String vector}
\defDefault{No default}
\defValue{Valid selectivity labels defined by \command{selectivity}}

\defSub{selectivities2} {Define the selectivities applied to each category}
\defType{String vector}
\defDefault{No default}
\defValue{Valid selectivity labels defined by \command{selectivity}}

\defSub{min\_age} {Define the minimum age for the observation}
\defType{Integer}
\defDefault{No default}
\defValue{A valid age in the range \commandsub{model}{min\_age} and \commandsub{model}{max\_age}}

\defSub{max\_age} {Define the maximum age for the observation}
\defType{Integer}
\defDefault{No default}
\defValue{A valid age in the range \commandsub{model}{min\_age} and \commandsub{model}{max\_age}}

\defSub{age\_plus\_group} {Define is the the maximum age for the observation is a plus group}
\defType{Switch}
\defDefault{True}
\defValue{Either true or false}

\defSub{ageing\_error} {Define the label of the ageing-error matrix to be applied}
\defType{String}
\defDefault{No default}
\defValue{A valid ageing error label}

\defSub{layer} {Name of the categorical layer used to group the spacial cells for the observation}
\defType{String}
\defDefault{No default}
\defValue{A valid layer as defined by \command{layer}. Must be a categorical layer}

\defSub{obs [label]}{Define the following data as observations for the categorical layer with value \argument{[label]}}
\defType{Constant vector}
\defDefault{No default}
\defValue{The label is valid value from the associated observation layer. It is followed by a vector of values giving the proportions at age. This subcommand is repeated for each unique value of label}

\defSub{error\_value [label]}{Define the following data as error values (e.g., $N$ for multinomial likelihoods, c.v. for lognormal likelihoods, etc.) for the categorical layer with value \texttt{[label]}}
\defType{Constant}
\defDefault{No default}
\defValue{A valid value from the associated observation layer. This subcommand is repeated for each unique value of label}

\defSub{likelihood}{Define the likelihood for the observation}
\defType{String}
\defDefault{No default}
\defValue{A valid likelihood}

\defSub{delta}{Define the delta robustifying constant for the likelihood}
\defType{Constant}
\defDefault{1e-11}
\defValue{A non-negative real number}

\defSub{process\_error}{Define the process error term}
\defType{Constant}
\defDefault{No process error}
\defValue{A non-negative real number}

\defSub{simulation\_likelihood}{Define the likelihood when doing simulations, if the observations is a pseudo-observation}
\defType{String}
\defDefault{No default}
\defValue{A valid likelihood, except not \texttt{none}. Note that this command is ignored if the observation is not a pseudo-observation}

\subsubsection[Abundance]{\commandlabsubarg{observation}{type}{abundance}}

\defSub{year} {Define the year that the observation applies to}
\defType{Integer}
\defDefault{No default}
\defValue{A positive integer between \commandsub{model}{initial\_year} and \commandsub{model}{current\_year}}

\defSub{time\_step} {Define the time-step that the observation applies to}
\defType{Integer}
\defDefault{No default}
\defValue{A valid time-step}

\defSub{proportion\_time\_step} {Define the interpolated proportion of the time-step passes that the observation applies to}
\defType{Constant}
\defDefault{1.0}
\defValue{A real number between 0 and 1, inclusive}

\defSub{catchability} {Define the catchability constant label for the observation}
\defType{String}
\defDefault{No default}
\defValue{A valid \command{catchability} label}

\defSub{categories} {Define the categories for which the observations occur}
\defType{String vector}
\defDefault{No default}
\defValue{Valid categories from \commandsub{model}{categories}}

\defSub{selectivities} {Define the selectivities applied to each category}
\defType{String vector}
\defDefault{No default}
\defValue{Valid selectivity labels defined by \command{selectivity}}

\defSub{layer} {Name of the categorical layer used to group the spacial cells for the observation}
\defType{String}
\defDefault{No default}
\defValue{A valid layer as defined by \command{layer}. Must be a categorical layer}

\defSub{obs [label]}{Define the following data as observations for the categorical layer with value \argument{[label]}}
\defType{Constant}
\defDefault{No default}
\defValue{The label is valid value from the associated observation layer. It is followed by a value giving the abundance. This subcommand is repeated for each unique value of label}

\defSub{error\_value [label]}{Define the following data as error values (e.g., $N$ for multinomial likelihoods, c.v. for lognormal likelihoods, etc.) for the categorical layer with value \texttt{[label]}}
\defType{Constant}
\defDefault{No default}
\defValue{A valid value from the associated observation layer. This subcommand is repeated for each unique value of label}

\defSub{likelihood}{Define the likelihood for the observation}
\defType{String}
\defDefault{No default}
\defValue{A valid likelihood}

\defSub{delta}{Define the delta robustifying constant for the likelihood}
\defType{Constant}
\defDefault{1e-11}
\defValue{A non-negative real number}

\defSub{process\_error}{Define the process error term}
\defType{Constant}
\defDefault{No process error}
\defValue{A non-negative real number}

\defSub{simulation\_likelihood}{Define the likelihood when doing simulations, if the observations is a pseudo-observation}
\defType{String}
\defDefault{No default}
\defValue{A valid likelihood, except not \texttt{none}. Note that this command is ignored if the observation is not a pseudo-observation}

\subsubsection[Biomass]{\commandlabsubarg{observation}{type}{biomass}}

\defSub{year} {Define the year that the observation applies to}
\defType{Integer}
\defDefault{No default}
\defValue{A positive integer between \commandsub{model}{initial\_year} and \commandsub{model}{current\_year}}

\defSub{time\_step} {Define the time-step that the observation applies to}
\defType{Integer}
\defDefault{No default}
\defValue{A valid time-step}

\defSub{proportion\_time\_step} {Define the interpolated proportion of the time-step passes that the observation applies to}
\defType{Constant}
\defDefault{1.0}
\defValue{A real number between 0 and 1, inclusive}

\defSub{catchability} {Define the catchability constant label for the observation}
\defType{String}
\defDefault{No default}
\defValue{A valid \command{catchability} label}

\defSub{categories} {Define the categories into which recruitment occurs}
\defType{String vector}
\defDefault{No default}
\defValue{Valid categories from \commandsub{model}{categories}}

\defSub{selectivities} {Define the selectivities applied to each category}
\defType{String vector}
\defDefault{No default}
\defValue{Valid selectivity labels defined by \command{selectivity}}

\defSub{layer} {Name of the categorical layer used to group the spacial cells for the observation}
\defType{String}
\defDefault{No default}
\defValue{A valid layer as defined by \command{layer}. Must be a categorical layer}

\defSub{obs [label]}{Define the following data as observations for the categorical layer with value \argument{[label]}}
\defType{Constant vector}
\defDefault{No default}
\defValue{The label is valid value from the associated observation layer. It is followed by a value giving the biomass. This subcommand is repeated for each unique value of label}

\defSub{error\_value [label]}{Define the following data as error values (e.g., $N$ for multinomial likelihoods, c.v. for lognormal likelihoods, etc.) for the categorical layer with value \texttt{[label]}}
\defType{Constant}
\defDefault{No default}
\defValue{A valid value from the associated observation layer. This subcommand is repeated for each unique value of label}

\defSub{likelihood}{Define the likelihood for the observation}
\defType{String}
\defDefault{No default}
\defValue{A valid likelihood}

\defSub{delta}{Define the delta robustifying constant for the likelihood}
\defType{Constant}
\defDefault{1e-11}
\defValue{A non-negative real number}

\defSub{process\_error}{Define the process error term}
\defType{Constant}
\defDefault{0}
\defValue{A non-negative real number}

\defSub{simulation\_likelihood}{Define the likelihood when doing simulations, if the observations is a pseudo-observation}
\defType{String}
\defDefault{No default}
\defValue{A valid likelihood, except not \texttt{none}. Note that this command is ignored if the observation is not a pseudo-observation}

\subsection{Defining ageing error}

Three methods for including ageing error into estimation with observations are,

\begin{itemize}
	\item None
	\item Normal
	\item Off-by-one
\end{itemize}

Each type of ageing error requires a set of subcommands and arguments specific to its type.

\defComLab{ageing\_error}{Define ageing error with \argument{label}}

\defSub{type} {The type of ageing error}
\defType{String}
\defDefault{No default}
\defValue{Defines the type of ageing error to use}

\subsubsection[No ageing error]{\commandlabsubarg{ageing\_error}{type}{none}}

The \commandlabsubarg{ageing\_error}{type}{none} has no other subcommands.

\subsubsection[Normal ageing error]{\commandlabsubarg{ageing\_error}{type}{normal}}

\defSub{cv} {Parameter of the normal ageing error model}
\defType{Constant}
\defDefault{No default}
\defValue{Define the c.v. of misclassification}

\defSub{k} {The $k$ parameter of the normal ageing error model}
\defType{Integer}
\defDefault{0}
\defValue{$cv$ defines the proportions of misclassification down and up using the normal model. $k$ defines the minimum age of individuals which can be misclassified, e.g., individuals under age $k$ have no ageing error}

\subsubsection[Off-by-one ageing error]{\commandlabsubarg{ageing\_error}{type}{off\_by\_one}}

\defSub{p1} {The $p_1$ parameter of the off-by-one ageing error model}
\defType{Constant}
\defDefault{No default}
\defValue{$p_1$ and $p_2$ define the proportions of misclassification down and up by 1 year respectively. $k$ defines the minimum age of individuals which can be misclassified, e.g. individuals under age $k$ have no ageing error}

\defSub{p2} {The $p_2$ parameter of the off-by-one ageing error model}
\defType{Constant}
\defDefault{No default}
\defValue{$p_1$ and $p_2$ define the proportions of misclassification down and up by 1 year respectively. $k$ defines the minimum age of individuals which can be misclassified, e.g., individuals under age $k$ have no ageing error}

\defSub{k} {The $k$ parameter of the off-by-one ageing error model}
\defType{Integer}
\defDefault{0}
\defValue{$p_1$ and $p_2$ define the proportions of misclassification down and up by 1 year respectively. $k$ defines the minimum age of individuals which can be misclassified, e.g., individuals under age $k$ have no ageing error}

