\section{Model overview\label{sec:getting-started}}\index{Getting started}

\subsection{Introduction}

The Spatial Population Model (\SPM) is a generalised spatially explicit age-structured population dynamics and movement model. It allows the implementation of population models suitable for the simulation and estimation of parameters in models with a large number of areas. It implements a statistical catch-at-age population dynamics and movement model, using a discrete time-step state-space model that represents a cohort-based population age structure in a spatially explicit manner. 

An \SPM\ model can be parametrised by both population processes (for example, ageing, recruitment, and mortality), and movement processes. Movement is by either adjacent cell movements or by global movements parametrised as the product of a set of preference functions based on known attributes at each spatial location. \SPM\ is designed to be flexible and to allow for the estimation of both population and movement parameters from local or aggregated spatially explicit observations. 

The population structure of \SPM\ follows the usual population modelling conventions and is similar to those implemented in other population models, for example CASAL\index{CASAL} \citep{1388}. The model records the numbers of individuals by age and category (i.e., male, female), as well as the locations of these cohorts within a spatial grid. In general, cohorts are added via a recruitment event, are aged annually, and are removed from the population via various forms of mortality. The population is assumed to be closed (i.e., no immigration or emigration from the modelled area)

The spatial component of \SPM\ is designed to allow for and to estimate movements of cohorts and groups of individuals between spatial locations, and hence allow for movement as well as spatially explicit observations and processes. 

A model is implemented in \SPM\ using an \config\ file\index{Input configuration file}, which is a complete description of the model structure (including the spatial and population processes), observations and estimation methods, and outputs requested. \SPM\ runs from a command prompt window in Microsoft Windows or from a text terminal in Linux. A model can be either \emph{run}, free parameters can be \emph{estimated} or \emph{MCMC} distributions calculated, and these estimates can be \emph{projected} into the future or used as an operating model to \emph{simulate} observations.

This section gives a quick overview of the model, and how to use it. Detailed descriptions of the components of \SPM, the model structures, mathematical equations used, and command and subcommand arguments are given in the following sections.

\subsection{Model specification}

A model in \SPM\ is specified in three parts, population, estimation, and output. These three section completely describe a model implemented in \SPM. See Sections \ref{sec:population-syntax}, \ref{sec:estimation-syntax}, and \ref{sec:output-syntax} for details and specification of \SPM s command and subcommand syntax. 

\subsubsection{The Population section}

The population section\index{Population section}(see Section \ref{sec:population-section}) defines the model of the movement and population dynamics. It describes the model spatial structure, defines the population and movement processes (e.g., recruitment, migration, natural mortality), defines the layers, selectivities, parameters, and specifies the population parameters.

The population section specifies the structure, model years, parameters, and processes of the model. It consists of several components, including;
\begin{itemize}
  \item The spatial and population structure
  \item Model initialisation (i.e., the state of the model in the first year)
  \item The annual cycle (time steps and processes that are applied in each time step)
  \item The specifications and parameters of the processes;
  \begin{itemize}
    \item Population processes (i.e., processes that add, remove, or shift numbers within each age/category)
    \item Spatial processes (i.e., processes that move or shift the spatial location but not age or category)
  \end{itemize}
  \item Layers and their definitions,
  \item Selectivities
  \item Parameter values and their definitions
  \item Derived quantities required as parameters for some processes (i.e., recruitment)
\end{itemize}

The spatial structure of \SPM\ is represented by an $n \times m$ grid, with rows $i=1 \dots n$ and columns $j=1 \ldots m$. Each cell of this matrix records the population structure at that point in space and is represented by an $k \times l$ rectangular matrix (with categories $k=1 \ldots k$ and ages $l=age_{min} \ldots age_{max}$. Hence we can describe any spatial and population element of the model as element$(i,j,k,l)$. We define, within this grid, locations where the population can and cannot potentially be present using a \emph{layer}. The layout of the grid can be either \emph{square} or \emph{hexagonal}.

Within each spatial grid cell, the population structure in \SPM\ is represented by a matrix containing an arbitrary number of user defined categories (rows), and an arbitrary age range (columns). Hence, each spatial cell has a population state described as $n_{categories} \times n_{ages}$ rectangular matrix with categories $k=1 \ldots n_{categories}$ and ages $l=age_{min} \ldots age_{max}$. 

Model initialisation can occur in several phases, each which iterates through a number of years carrying out the population and/or spatial processes defined for that phase. Analytical initialisation is not implemented in \SPM, hence equilibrium and initial population states must be evaluated iteratively. At then end of the initialisation, \SPM\ runs through the model years carrying out processes in the order defined in the annual cycle, and can evaluate expected values of observations in order to calculate likelihoods, project forward to determine future states, or simulate observations from the current state.

\SPM\ has two types of processes, \emph{population}\index{Population processes} and \emph{movement}\index{Movement processes} processes. \emph{Population} processes are those processes which modify, move or otherwise change the numbers of individuals \emph{within} a spatial cell, i.e., they do not affect the spatial location of a cohort. \emph{Movement} processes, on the other hand, move, shift or otherwise modify cohorts between spatial cells, but do not affect the age or category of the numbers in each cohort. 

The population processes include recruitment\index{Recruitment}, ageing\index{Ageing},  mortality\index{Mortality} events (e.g., natural and exploitation) and category transition processes\index{Category transition} (i.e., processes that move individuals between categories, while preserving their age structure.) 

Each of these processes is carried out in the user-defined prescribed order when initialising the model, and then for a user-defined order in each year in the annual cycle\index{Annual cycle}.

\SPM\ implements two different movement processes\index{Movement};
\begin{enumerate}
	\item  A migration movement rate of cohorts between any two locations, and is roughly analogous to movements between areas as implemented in other population models, such as CASAL \citep{1388}. 
	\item Movements between locations parametrised as a probability density function. Here, the key underlying idea is that the spatial distribution of cohorts at any point in time and at any location can be represented as a density function based on attributes of that location, local abundance, and/or distance moved. 
\end{enumerate}

We use the term \emph{preference function}\index{Preference function} \citep{1366,1367} to describe the movement probability distributions. We assume that the population and spatial extent are defined, and that there is a preference function that is a function of some (typically estimable) parameters and a spatially explicit set of known attributes.The preference function movement process allows the number of parameters describing movement to to reduced, and results in a movement process that is some function of some underlying property of each location. For example, if we assume that movement between areas was a function of the Euclidean distance between areas, we could model movement between any two areas as a linear decay or exponential decay function \citep{1366}. Alternately, if distribution and density were correlated with bathymetric depth for a marine organism, we might model the movement and distribution as a function of depth. 

Processes may require, as arguments, some derived quantity. For example, recruitment may require a spawning stock biomass value to resolve the stock-recruit relationship. Derived quantities are defined in the population section.

\subsubsection{The estimation section}

The estimation section\index{Estimation section} specifies the free parameters, estimation methods, observations, penalties and priors. Estimation is based on an objective function (e.g., negative log posterior). Depending on the run mode, the estimation section is used to specify the methods for finding a point estimate (i.e., the set of parameter values that minimizes the objective function), doing profiles, or MCMC methods and options, etc.

Types of estimation

Types of observation

Likelihoods

Priors and penalties


\subsubsection{The output section}

The output section\index{Output section} specifies to model outputs. It defines the quantities and model components to be output to external files or to the screen. While \SPM\ will provide informational messages to the screen, the \SPM\ will only produce model estimates, population states, and other data as requested by the output section. 

Print states

Pront free parameters

Print summaries


\subsection{Layers\label{sec:layers}}

\emph{Layers} are an important component of a model in \SPM. Every model must define at least one layer. A layer is defined as a $n_{rows} \times n_{cols}$ grid of values (with one exception \textemdash the distance layer, see below), where the value for each cell represents a known quantity. For example layers may represent classifications, physical attributes, or some other assumed quantity. SPM defines the following types of layer:

\begin{enumerate}
\item The \emph{base layer} $L_B$: In any model there is one and only one base layer $L_B$, that defines the locations where the population can and cannot potentially be present (e.g., in a marine model, the locations associated with the sea and not land). Here, we define that a cell may potentially have part of the population present if $L_B(i,j) ge 0$. The base layer must always be defined, have only numeric values and have valid value for every cell in the spatial grid.

\item A \emph{distance layer}: A distance layer is one that defines the distance between any two cells. By default, \SPM\ calculates the values of the distance layer as the Euclidean distance (where the grid type is \argument{square} \textemdash see Section \ref{sec:population-section} for distance calculations for the hexagon grid type). Here, the distance between cell a and cell b can be defined as,

\[
d\left( {a,b} \right) = \lambda \sqrt {\left( {x_a  - x_b } \right)^2  + \left( {y_a  - y_b } \right)^2 } 
\]

where $x$ and $y$ represent the x- and y-coordinates of $a$ and $b$ respectively, and $\lambda$ is an arbitrary scaler representing the length of one side of the sqaure. Unlike other types of layers, distance layers are not a $n_{rows} \times n_{cols}$ grid of values, but rather a matrix of dimension $(n_{rows} \times n_{ccols}) \times (n_{rows} \times n_{ccols})$  where the distance between each cell and every other cell is evaluated. Note that under this definition, the distance between any cell and itself is 0. 

\item A \emph{quantity layer}: A quantity layer is simply the count, biomass, or density of the number of individuals within each cell within categories $k$ and with selectivity $S$. SPM calculates the values of an quantity layer when running the model at the point in time where the value is required. Quantities can be 

\begin{enumerate}

\item Abundance, the sum of the number of individuals within cell $a$ in categories $k$ and with selectivity $S$,

\[
N\left( a \right) = \sum\limits_{k \in K} {\sum\limits_l {S_l element\left( {i,j,k,l} \right)} } 
\]

\item Biomass, the sum of the biomass of individuals within cell $a$ in categories $k$ and with selectivity $S$,

\[
N\left( a \right) = \sum\limits_{k \in K} {\sum\limits_l {S_l element\left( {i,j,k,l} \right)} } 
\]

\item abundance-density, the density (sum divided by cell area as defined in the base layer) of the number of individuals within cell $a$ in categories $k$ and with selectivity $S$,

\[
N\left( a \right) = \sum\limits_{k \in K} {\sum\limits_l {S_l element\left( {i,j,k,l} \right)} } 
\]

\item biomass-density, the density (sum divided by cell area as defined in the base layer) of the biomass of individuals within cell $a$ in categories $k$ and with selectivity $S$,

\[
N\left( a \right) = \sum\limits_{k \in K} {\sum\limits_l {S_l element\left( {i,j,k,l} \right)} } 
\]

\end{enumerate}

\item A \emph{numeric layer}: A model may have many numeric layers, and these can be used as covariates of a population or movement process (e.g., depth may be a covariate of some movement process), and/or locations of event mortality. Numeric layers can contain only continuous (numeric) variables. Values for a numeric layer must be supplied for each cell by the user.

\item A \emph{categorical layer}: A model may have many categorical layers, and these are used as a classification or grouping variable for aggregating data over individual cells, e.g., management areas. Such layers are typically used to aggregate the population within cells into groups for comparing with observations. The values in layers used as categorical layers can contain any characters (except white space), and are interpreted as categorical values. Values for a categorical layer must be supplied for each cell by the user.

\end{enumerate}

\subsubsection{Meta-layers\label{meta-layers}}

In addition to the above types of layer, \SPM\ defines a special type of layer known as a \emph{meta-layer}. The meta-layer allows individual layers to be indexed by year, and applied as a single layer within the model. For example, assume that we had a model where we wished to use Sea Surface Temperature (SST) as a layer, perhaps to control some movement process. The SST values for each year of the model would be defined as individual numeric layers, each with a unique label. We could then define a meta-layer that indexed the individual annual SST layers by year, and use the meta-layer as the control layer in the movement process. 

\subsection{Derived quantities}

\subsection{Annually varying parameters}

